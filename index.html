
<html>
  <head>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.3.0/flowbite.min.css" rel="stylesheet" />
    <script type="text/javascript" src="https://unpkg.com/webcam-easy/dist/webcam-easy.min.js"></script>
    <link rel="stylesheet" href="style.css">
  </head>

  <body>
    <h1 style="font-weight: bold; font-size: 4em; text-align: center; color: white;">Image Classifier</h1>
    <br><br>
    <form class="max-w-sm mx-auto">
      <div class="mb-5">
        <video id="webcam"autoplay playsinline width="400" height="600"></video>
      </div>
      <div id="controls" class="mb-5">
        <button onclick="flipCamera()" class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm w-full sm:w-auto px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800">Flip Camera</button>
      </div>
      <!-- <button type="button" onclick="predict()" class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm w-full sm:w-auto px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800">Predict</button> -->
      <br>
      <p id="result" style="font-weight: bolder; font-size: 3em; text-align: center;"></p>
    </form>

    <script>
      startPrediction()
      let webcamElement = document.getElementById('webcam');
      let resultElement = document.getElementById('result');
      let useFrontCamera = true;
      let model;
  
      async function setupWebcam(useFrontCamera) {
        return new Promise((resolve, reject) => {
          const navigatorAny = navigator;
          navigator.getUserMedia = navigator.getUserMedia ||
            navigatorAny.webkitGetUserMedia || navigatorAny.mozGetUserMedia ||
            navigatorAny.msGetUserMedia;
          if (navigator.getUserMedia) {
            navigator.getUserMedia(
              { 
                video: { 
                  facingMode: useFrontCamera ? 'user' : 'environment' 
                } 
              },
              stream => {
                webcamElement.srcObject = stream;
                webcamElement.addEventListener('loadeddata', () => resolve(), false);
              },
              error => reject());
          } else {
            reject();
          }
        });
      }
      function flipCamera() {
          useFrontCamera = !useFrontCamera;
          setupWebcam(useFrontCamera);
        }
  
      async function predict() {
        const videoFrame = tf.browser.fromPixels(webcamElement).cast('float32');
        const resizedFrame = videoFrame.resizeBilinear([300, 300]);
        const batchedFrame = resizedFrame.expandDims(0);
  
        const prediction = await model.predict(batchedFrame);
        const class_scores = await prediction.data();  
        const max_score_id = class_scores.indexOf(Math.max(...class_scores));
        const classes = ["Pattern", "Solid"];
  
        resultElement.innerHTML = classes[max_score_id].toString();
  
        requestAnimationFrame(predict);
      }
  
      async function startPrediction() {
        model = await tf.loadGraphModel('./model.json');
        await setupWebcam();
        predict();
      }
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.3.0/flowbite.min.js"></script>
  </body>
</html>